// Generated by toolgen. DO NOT EDIT.
// Generated from tool specification:
//   _build/specifications/goreleaser.json

package build

import (
	"fmt"
	"time"

	"github.com/stephenwilliams/go-clitools/internal/defaults"
	"github.com/stephenwilliams/go-clitools/ptrhelpers"
	"github.com/stephenwilliams/go-clitools/tools"
	"github.com/stephenwilliams/go-clitools/tools/goreleaser"
)

// Builds the current project
func Build(opts ...BuildOpt) *tools.CommandContext {
	options := &buildOptions{}

	for _, optFunc := range opts {
		optFunc(options)
	}

	var _args []string
	_args = append(_args, "build")

	_args = append(_args, options.toArgs()...)

	return &tools.CommandContext{
		Args: _args,
		Path: tools.MustResolveTool(goreleaser.GoReleaserToolInfo, defaults.String(options.ToolVersion, goreleaser.DefaultToolVersion), options.ToolProvider, goreleaser.DefaultToolProvider, tools.DefaultToolProvider),
	}
}

type BuildOpt func(*buildOptions)

func SetToolProvider(p tools.ToolProvider) BuildOpt {
	return func(opts *buildOptions) {
		opts.ToolProvider = p
	}
}

func SetToolVersion(v string) BuildOpt {
	return func(opts *buildOptions) {
		opts.ToolVersion = v
	}
}

// Skips all post-build hooks
func SkipPostHooks() BuildOpt {
	return func(opts *buildOptions) {
		opts.skipPostHooks = ptrhelpers.Bool(true)
	}
}

// Skips several sanity checks
func SkipValidate() BuildOpt {
	return func(opts *buildOptions) {
		opts.skipValidate = ptrhelpers.Bool(true)
	}
}

// Load configuration from file
func Config(value string) BuildOpt {
	return func(opts *buildOptions) {
		opts.config = &value
	}
}

// Amount tasks to run concurrently
//
//  defaults to the number of logical CPUs usable by the current process
func Parallelism(value int) BuildOpt {
	return func(opts *buildOptions) {
		opts.parallelism = &value
	}
}

// Remove the dist folder before building
func RemoveDist() BuildOpt {
	return func(opts *buildOptions) {
		opts.removeDist = ptrhelpers.Bool(true)
	}
}

// Generate an unversioned snapshot build, skipping all validations and without publishing any artifacts
func Snapshot() BuildOpt {
	return func(opts *buildOptions) {
		opts.snapshot = ptrhelpers.Bool(true)
	}
}

// Timeout to the entire build process (default 30m0s)
func Timeout(value time.Duration) BuildOpt {
	return func(opts *buildOptions) {
		opts.timeout = &value
	}
}

type buildOptions struct {
	ToolProvider  tools.ToolProvider
	ToolVersion   string
	skipPostHooks *bool
	skipValidate  *bool
	config        *string
	parallelism   *int
	removeDist    *bool
	snapshot      *bool
	timeout       *time.Duration
}

func (o *buildOptions) toArgs() []string {
	var renderedArgs []string

	if o.skipPostHooks != nil {
		renderedArgs = append(renderedArgs, "--skip-post-hooks")
	}

	if o.skipValidate != nil {
		renderedArgs = append(renderedArgs, "--skip-validate")
	}

	if o.config != nil {
		renderedArgs = append(renderedArgs, "--config", fmt.Sprintf("%s", ptrhelpers.StringValue(o.config)))
	}

	if o.parallelism != nil {
		renderedArgs = append(renderedArgs, "--parallelism", fmt.Sprintf("%d", ptrhelpers.IntValue(o.parallelism)))
	}

	if o.removeDist != nil {
		renderedArgs = append(renderedArgs, "--rm-dist")
	}

	if o.snapshot != nil {
		renderedArgs = append(renderedArgs, "--snapshot")
	}

	if o.timeout != nil {
		renderedArgs = append(renderedArgs, "--timeout", fmt.Sprintf("%s", o.timeout))
	}

	return renderedArgs
}
